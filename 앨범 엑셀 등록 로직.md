# 앨범 엑셀 등록 로직

## 1. 변환 처리 방식

### 기본 처리 원칙
- **빈 항목 처리**: 시스템상 필요하지만 엑셀에서 비어있는 항목은 무시 → `null`로 생성
- **중복 UPC 검증**: 동일한 UPC가 이미 존재한다면 해당 앨범 생성은 하지 않음

### 날짜 및 시간 처리
- **발매일, 발매시간**: 한국(KST) 기준으로 엑셀에 입력됨
- **시간대 변환**: KST → UTC로 자동 변환하여 저장

### 등급 및 서비스 처리
- **이용등급**:
  - `Y` → 19금 콘텐츠 (`true`)
  - `N` 또는 공백 → 일반 (`false`)
- **M/V 처리**:
  - 비어있으면 `N`으로 처리 (M/V 없음)

### 아티스트 및 기여자 처리
- **아티스트 구분자**: `,` 또는 `\n`, `|`, `&`로 구분
- **순서 일치**: 국문 아티스트 리스트와 영문 아티스트 리스트의 순서가 동일
- **중복 아티스트**: 국문명, 영문명이 동일한 아티스트는 동일한 아티스트로 처리
- **기여자 처리**: 작사/작곡/편곡은 `contributor`로만 처리
- **빈 값 처리**: 아티스트, 기여자란에 `-`만 있다면 아티스트, 기여자 없음으로 처리

### 특수 처리
- **Inst 트랙**: 작사가 없으면 inst 트랙으로 처리
- **레이블 처리**: 엑셀 '레이블' 항목 → 권리사 생성 없이 `album.agencyCompanyName`으로만 처리
- **돌비 음원**: `""`, `"N (돌비 음원 없음?)"`, `"돌비X"` → 돌비음원 없음으로 처리

## 2. 엑셀과 디비 필드 매핑 정보

### 아티스트 정보 매핑
```json
{
  "artist": {
    "아티스트명(국문)": "name",           // album.releaseArtistList 에서 참조됨
    "아티스트명(영문)": "nameEn",         // album.releaseArtistList 에서 참조됨
    "트랙아티스트(국문)": "name",         // track.releaseArtistList 에서 참조됨
    "트랙아티스트(영문)": "nameEn"        // track.releaseArtistList 에서 참조됨
  }
}
```

### 앨범 정보 매핑
```json
{
  "album": {
    "앨범명(국문)": "titleList.ko",
    "앨범명(영문)": "titleList.en",
    "아티스트(국문)": "releaseArtistList[].name",      // artist 컬렉션 참조
    "아티스트(영문)": "releaseArtistList[].nameEn",    // artist 컬렉션 참조
    "발매일": "utcReleasedAt",
    "발매시간": "utcServiceStartedAt",
    "앨범유형": "albumType",
    "장르대분류": "mainGenre",
    "장르소분류": "subGenre",
    "UPC": "UPC",
    "앨범코드": "albumUniqueId",
    "서비스지역": "supplyRegion/excludedRegionList",   // Worldwide 고정, 해외만 발매 시 excludedRegionList=['KR']
    "레이블": "agencyCompanyName"
  }
}
```

### 트랙 정보 매핑
```json
{
  "track": {
    "곡코드": "trackUniqueId",
    "CD": "discNumber",                   // 없으면 1, 있으면 해당 number
    "트랙번호": "trackNumber",
    "타이틀": "isTitle",                  // Y/y→true, N/n/''→false
    "이용등급": "isAdultOnly",            // Y/y→true, N/n/''→false
    "트랙명(국문)": "titleList.ko",
    "트랙명(영문)": "titleList.en",
    "ISRC": "ISRC",
    "ISRC(돌비)": "spatialAudioInfo.ISRC",
    "트랙아티스트(국문)": "releaseArtistList[].name",      // artist 컬렉션 참조
    "트랙아티스트(영문)": "releaseArtistList[].nameEn",    // artist 컬렉션 참조
    "M/V": "isMVService",                 // Y/y→true, N/n/''→false
    "작사": "contributorList[]",           // contributor로 처리
    "작곡": "contributorList[]",           // contributor로 처리
    "편곡": "contributorList[]"            // contributor로 처리
  }
}
```

## 3. 구현 시 고려사항

### 데이터 검증
- UPC 중복 체크 필수
- 필수 필드 누락 시 적절한 에러 처리
- 날짜 형식 검증 (KST → UTC 변환)

### 성능 최적화
- 대량 데이터 처리 시 배치 처리 고려
- 트랜잭션 처리로 데이터 일관성 보장

### 에러 처리
- 엑셀 파싱 오류 시 상세한 에러 메시지 제공
- 부분 실패 시 롤백 처리 방안 고려
